<form (ngSubmit)="save()">
  <mat-card>
    <mat-card-header>
      <h4 mat-card-avatar>#{{ participant.startNumber + 1 }}</h4>
      <mat-card-title>
        <h3>{{ participant.team.name }} - {{ participant.discipline.name}}</h3>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div role="table">
        <div role="row">
          <section *ngFor="let group of groupedScores" class="x{{ group.scores ? group.scores.length : '0' }} group_{{ group.group.type }}">
            <header>
              {{ group.group.name }}
            </header>
            <span *ngFor="let score of group.scores" class="score-field">
              <label for="field_{{ score.scoreGroup.type }}_{{score.judgeIndex}}">
                {{score.scoreGroup.type}}{{score.judgeIndex}}
              </label>
              <input type="number"
                      id="field_{{ score.scoreGroup.type }}_{{score.judgeIndex}}"
                      name="field_{{ score.scoreGroup.type }}_{{score.judgeIndex}}"
                      max="{{ group.group.max }}"
                      min="{{ group.group.min }}"
                      maxlength="3"
                      step="0.1"
                      [(ngModel)]="score.value"
                      (blur)="onBlur($event)"/>
            </span>

            <footer>
              <span translate>Calculated: </span>
              <code>{{ group.avg || 0 | number:'1.2-2' }}&nbsp;</code>
            </footer>
          </section>

          <section class="final">
            <header translate>Final score</header>
            <div *ngFor="let type of groupedScores">
              <span>
                <label class="large">{{ type.group.type }} : </label>
                <label class="small">{{ type.group.name }}
                  <small>[{{ type.group.type }}]</small>: </label>
              </span>
              <code>{{ type.avg || 0 | number:'1.2-2' }}&nbsp;</code>
            </div>
            <footer>
              <span>
                <label class="large">F:</label>
                <label class="small" translate>Final score:</label>
              </span>
              <code>{{ grandTotal | number:'1.3-3' }}</code>
            </footer>
          </section>
        </div>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <app-save-button buttonType="submit"></app-save-button>
      <button mat-raised-button type="button" [title]="'Cancel' | translate" (click)="close()">
        <i class="fa fa-fw fa-ban"></i>
        <span translate>Cancel</span>
      </button>
      <button mat-raised-button *ngIf="participant.publishTime == null || currentUser.role >= roles.Organizer" type="button" [title]="'Delete' | translate"
        class="pull-right mat-warn" (click)="delete()">
        <i class="fa fa-fw fa-trash"></i>
        <span *ngIf="participant.publishTime == null && participant.endTime == null" translate>Delete</span>
        <span *ngIf="participant.publishTime == null && participant.endTime != null" translate>Empty scores</span>
        <span *ngIf="participant.publishTime != null" translate>Allready published!</span>
      </button>
      <button mat-raised-button *ngIf="participant.endTime != null && currentUser.role >= roles.Organizer" type="button" [title]="'Rollback' | translate"
        class="pull-right mat-warn" (click)="rollback()">
        <i class="fa fa-fw fa-undo"></i>
        <span translate>Rollback</span>
      </button>
      <div *ngIf="participant.publishTime != null && currentUser.role < roles.Organizer" class="pull-right warning">
        <span translate>Allready published!</span>
      </div>
    </mat-card-actions>
  </mat-card>
</form>
